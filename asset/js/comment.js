if(!window.SUPABASE_URL||!window.SUPABASE_KEY)throw new Error("Supabase URL dan key belum diatur! Harap set di `.env` file. Salin `.env.example` dan ubah menjadi `.env`. Jangan set nilai pada `.env.example`!");const db=supabase.createClient(window.SUPABASE_URL,window.SUPABASE_KEY),ls_user_key="COMMENT_USER";let comments_shown=!1;const BLACKLISTED_WORDS=["anjing","babi","bodoh","brengsek","tolol","bangsat","goblok","kampret","bajingan","setan","keparat","sialan","jelek","cacat","gila","idiot","sinting","lemah","kunyuk","monyet","dungu","pikun","klik di sini","gratis","promo","diskon","terbaik","murah","hubungi sekarang","daftar di sini","dijamin","gabung grup","like dan subscribe","follow saya","pin bbm","whatsapp saya","cepat kaya","transfer uang","menangkan hadiah","investasi mudah","pinjaman cepat","https://","http://"];async function send_comment(e){e.preventDefault();const t=e.target||e.currentTarget;if(!t)return;const n=new FormData(t),a=n.get("name")?.toString(),o=n.get("email")?.toString(),i=n.get("description")?.toString();if(!a||!i)return void alert("Tolong isi nama dan komentar Anda.");for(const e of BLACKLISTED_WORDS)if(i.toLowerCase().includes(e.toLowerCase()))return void alert("Komentar Anda mengandung kata yang tidak diizinkan.");const r=t.elements.Kirim;if(!r.disabled)try{r.disabled=!0,r.innerHTML='<span class="loading loading-dots loading-md"></span>';const{error:e}=await db.from("comments").insert({slug:location.pathname,name:a,email:o,description:i});if(e)throw new Error("Server error");t.elements.description.value="";const n=document.createElement("p");n.className="text-success mt-4",n.innerText="Komentar telah dikirim. Terima kasih atas partisipasinya!",t.appendChild(n),setTimeout((()=>n.remove()),5e3),comments_shown&&load_comments().catch((e=>console.error(e))),await update_comment_count(),localStorage.setItem(ls_user_key,JSON.stringify({name:a,email:o}))}catch(e){alert("Komentar gagal dimuat."),console.error(`Terjadi error saat mengirim komentar: ${e.message||"Error tidak diketahui"}`)}finally{r.disabled=!1,r.innerHTML="Kirim"}}async function load_comments(){const e=document.getElementById("comment-list-container");if(!e)return void console.warn("Comment list container element was null");const{data:t,error:n}=await db.from("comments").select("name,description,created_at").order("created_at",{ascending:!1}).eq("slug",location.pathname).or("hidden.is.null,hidden.eq.false");if(n)throw n;if(t?.length){e.innerHTML="";for(const n of t){const t=document.createElement("div");t.innerHTML=`\n\t\t\t<p>\n\t\t\t\t<strong class="text-secondary">${n.name}</strong> &#8211;\n\t\t\t\t<em class="text-xs">${new Date(n.created_at).toLocaleString()}</em>\n\t\t\t</p>\n\t\t\t<p>${n.description}</p>\n\t\t`,e.appendChild(t)}}else e.innerHTML="Belum ada komentar, jadilah yang pertama."}async function see_comments(e){const t=e.currentTarget||e.target;if(t)try{t.disabled=!0,t.innerHTML='<span class="loading loading-dots loading-md"></span>',await load_comments(),comments_shown=!0,t.classList.add("hidden")}catch(e){alert("Gagal memuat komentar"),console.error(`Terjadi error saat mengirim komentar: ${e.message||"Error tidak diketahui"}`)}finally{t.disabled=!1,t.innerHTML="Lihat semua komentar"}}async function update_comment_count(){const e=document.querySelectorAll(".indicator-item");if(e.length)try{const{count:t,error:n}=await db.from("comments").select("*",{count:"exact",head:!0}).eq("slug",location.pathname).or("hidden.is.null,hidden.eq.false");if(n)throw n;const a=t>99?"99+":t.toString();e.forEach((e=>{t>0?(e.textContent=a,e.classList.remove("hidden")):e.classList.add("hidden")}))}catch(t){console.error("Gagal memperbarui jumlah komentar:",t.message||t),e.forEach((e=>{e.classList.add("hidden")}))}}window.addEventListener("load",(()=>{const e=document.getElementById("comment-form");e.onsubmit=async e=>{await send_comment(e),await update_comment_count()};const t=JSON.parse(localStorage.getItem(ls_user_key)||"{}");e.elements.name.value=t.name||"",e.elements.email.value=t.email||"";document.getElementById("comment-list-loader").onclick=see_comments,update_comment_count()}));