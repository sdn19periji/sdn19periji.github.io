if(!window.SUPABASE_URL||!window.SUPABASE_KEY)throw new Error("Supabase url and key are not set yet! Please set in `.env` file. Copy `.env.example` and paste to `.env`. Never set value to `.env.example` file!");const db=supabase.createClient(window.SUPABASE_URL,window.SUPABASE_KEY),ls_user_key="COMMENT_USER";let comments_shown=!1;async function send_comment(e){e.preventDefault();const t=e.target||e.currentTarget;if(!t)return;const n=new FormData(t),a=n.get("name")?.toString(),o=n.get("email")?.toString(),r=n.get("description")?.toString();if(!a||!r)return void alert("Tolong isi nama dan email anda");const i=t.elements.Kirim;if(!i.disabled)try{i.disabled=!0,i.innerHTML='<span class="loading loading-dots loading-md"></span>';const{error:e}=await db.from("comments").insert({slug:location.pathname,name:a,email:o,description:r});if(e)throw new Error("Server error");t.elements.description.value="";const n=document.createElement("p");n.className="text-success mt-4",n.innerText="Komentar telah dikirim. Terima kasih atas partisipasinya! Mohon tunggu konfirmasi dari kami.",t.appendChild(n),setTimeout((()=>n.remove()),5e3),comments_shown&&load_comments().catch((e=>console.error(e))),localStorage.setItem(ls_user_key,JSON.stringify({name:a,email:o}))}catch(e){alert("Komentar gagal dimuat."),console.error(`Terjadi error saat mengirim komentar: ${e.message||"Error tidak diketahui"}`)}finally{i.disabled=!1,i.innerHTML="Kirim"}}async function see_comments(e){const t=e.currentTarget||e.target;if(t)try{t.disabled=!0,t.innerHTML='<span class="loading loading-dots loading-md"></span>',await load_comments(),comments_shown=!0,t.classList.add("hidden")}catch(e){alert("Gagal memuat komentar"),console.error(`Terjadi error saat mengirim komentar: ${e.message||"Error tidak diketahui"}`)}finally{t.disabled=!1,t.innerHTML="Lihat semua komentar"}}async function load_comments(){const e=document.getElementById("comment-list-container");if(!e)return void console.warn("Comment list container element was null");const{data:t,error:n}=await db.from("comments").select("name,description,created_at").order("created_at",{ascending:!1}).eq("slug",location.pathname).or("hidden.is.null,hidden.eq.false");if(n)throw n;if(t?.length){e.innerHTML="";for(const n of t){const t=document.createElement("div");t.innerHTML=`\n\t\t\t<p>\n\t\t\t\t<strong class="text-secondary">${n.name}</strong> &#8211;\n\t\t\t\t<em class="text-xs">${new Date(n.created_at).toLocaleString()}</em>\n\t\t\t</p>\n\t\t\t<p>${n.description}</p>\n\t\t`,e.appendChild(t)}}else e.innerHTML="Belum ada komentar, jadilah yang pertama."}window.addEventListener("load",(()=>{const e=document.getElementById("comment-form");e.onsubmit=send_comment;const t=JSON.parse(localStorage.getItem(ls_user_key)||"{}");e.elements.name.value=t.name||"",e.elements.email.value=t.email||"";document.getElementById("comment-list-loader").onclick=see_comments}));