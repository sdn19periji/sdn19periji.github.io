const calendar=document.querySelector(".calendar"),date=document.querySelector(".date"),daysContainer=document.querySelector(".days"),prev=document.querySelector(".prev"),next=document.querySelector(".next"),todayBtn=document.querySelector(".today-btn"),gotoBtn=document.querySelector(".goto-btn"),dateInput=document.querySelector(".date-input"),eventDay=document.querySelector(".event-day"),eventDate=document.querySelector(".event-date"),eventsContainer=document.querySelector(".events"),addEventBtn=document.querySelector(".add-event"),addEventWrapper=document.querySelector(".add-event-wrapper "),addEventCloseBtn=document.querySelector(".close "),addEventTitle=document.querySelector(".event-name "),addEventFrom=document.querySelector(".event-time-from "),addEventTo=document.querySelector(".event-time-to "),addEventSubmit=document.querySelector(".add-event-btn ");let activeDay,today=new Date,month=today.getMonth(),year=today.getFullYear();const categoryColors={PPDB:"border-b-4 border-b-green-500","awal masuk semester":"border-b-4 border-b-blue-500","libur nasional":"border-b-4 border-b-red-500","pembagian rapor":"border-b-4 border-b-yellow-500",TSSP:"border-b-4 border-b-purple-500","libur puasa":"border-b-4 border-b-orange-500",ulangan:"border-b-4 border-b-pink-500","libur semester":"border-b-4 border-b-teal-500",anbk:"border-b-4 border-b-indigo-500","hari minggu":"border-b-4 border-b-gray-500"},months=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];async function fetchEvents(){try{const e=await fetch("/kegiatan.json"),t=await e.json();return Array.isArray(t)?t:(console.error("Data fetched is not an array:",t),[])}catch(e){return console.error("Error fetching events:",e),[]}}let eventsArr=[];function initCalendar(){const e=new Date(year,month,1),t=new Date(year,month+1,0),n=new Date(year,month,0).getDate(),r=t.getDate(),a=e.getDay(),o=7-t.getDay()-1;date.innerHTML=months[month]+" "+year;let d="";for(let e=a;e>0;e--){const t=n-e+1;let r=!1,a="";Array.isArray(eventsArr)&&eventsArr.forEach((e=>{e.day===t&&e.month===(0===month?12:month)&&e.year===(0===month?year-1:year)&&(r=!0,a=e.events[0]?.category||"")}));const o=categoryColors[a]||"",s=0===new Date(year,month-1,t).getDay()?"text-error":"";d+=r?`<div class="day prev-date event btn btn-sm btn-ghost ${o} ${s}">${t}</div>`:`<div class="day prev-date btn btn-sm btn-ghost ${s}">${t}</div>`}for(let e=1;e<=r;e++){let t=!1,n="";Array.isArray(eventsArr)&&eventsArr.forEach((r=>{r.day===e&&r.month===month+1&&r.year===year&&(t=!0,n=r.events[0]?.category||"")}));const r=categoryColors[n]||"",a=0===new Date(year,month,e).getDay()?"text-error":"";e===(new Date).getDate()&&year===(new Date).getFullYear()&&month===(new Date).getMonth()?(activeDay=e,getActiveDay(e),updateEvents(e),d+=t?`<div class="day today active event btn btn-sm btn-secondary dark:btn-info border-b-4 border-b-base-100 dark:border-b-base-content ${r} ${a}">${e}</div>`:`<div class="day today active btn btn-sm btn-secondary dark:btn-primary ${a}">${e}</div>`):d+=t?`<div class="day event btn btn-sm btn-ghost border-b-4 border-b-accent ${r} ${a}">${e}</div>`:`<div class="day btn btn-sm btn-ghost ${a}">${e}</div>`}for(let e=1;e<=o;e++){let t=!1,n="";Array.isArray(eventsArr)&&eventsArr.forEach((r=>{r.day===e&&r.month===(11===month?1:month+2)&&r.year===(11===month?year+1:year)&&(t=!0,n=r.events[0]?.category||"")}));const r=categoryColors[n]||"",a=0===new Date(year,month+1,e).getDay()?"text-error":"";d+=t?`<div class="day next-date event btn btn-sm btn-ghost ${r} ${a}">${e}</div>`:`<div class="day next-date btn btn-sm btn-ghost ${a}">${e}</div>`}daysContainer.innerHTML=d,addListner()}function prevMonth(){month--,month<0&&(month=11,year--),initCalendar()}function nextMonth(){month++,month>11&&(month=0,year++),initCalendar()}function addListner(){const e=document.querySelectorAll(".day");e.forEach((t=>{t.addEventListener("click",(t=>{getActiveDay(t.target.innerHTML),updateEvents(Number(t.target.innerHTML)),activeDay=Number(t.target.innerHTML),e.forEach((e=>{e.classList.remove("active")})),t.target.classList.contains("prev-date")?(prevMonth(),setTimeout((()=>{document.querySelectorAll(".day").forEach((e=>{e.classList.contains("prev-date")||e.innerHTML!==t.target.innerHTML||e.classList.add("active")}))}),100)):t.target.classList.contains("next-date")?(nextMonth(),setTimeout((()=>{document.querySelectorAll(".day").forEach((e=>{e.classList.contains("next-date")||e.innerHTML!==t.target.innerHTML||e.classList.add("active")}))}),100)):t.target.classList.add("active")}))}))}function gotoDate(){console.log("here");const e=dateInput.value.split("/");if(2===e.length&&e[0]>0&&e[0]<13&&4===e[1].length)return month=e[0]-1,year=e[1],void initCalendar();alert("Invalid Date")}function getActiveDay(e){const t=["Minggu, ","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][new Date(year,month,e).getDay()];eventDay.innerHTML=t,eventDate.innerHTML=", "+e+" "+months[month]+" "+year}function updateEvents(e){let t="";Array.isArray(eventsArr)&&eventsArr.forEach((n=>{e===n.day&&month+1===n.month&&year===n.year&&n.events.forEach((e=>{e.category;t+=`<div class="event">\n              <div class="title">\n                <h3 class="event-title">${e.title}</h3>\n              </div>\n              <div class="event-time">\n                <span class="event-time text-base-content/70">${e.time}</span>\n              </div>\n          </div>`}))})),""===t&&(t='<div class="no-event">\n            <h3>Hari efektif</h3>\n        </div>'),eventsContainer.innerHTML=t}function saveEvents(){}function getEvents(){}function convertTime(e){let t=e.split(":"),n=t[0],r=n>=12?"PM":"AM";return n=n%12||12,e=n+":"+t[1]+" "+r}fetchEvents().then((e=>{eventsArr=e,getEvents(),initCalendar()})).catch((e=>{console.error("Failed to initialize events:",e)})),prev.addEventListener("click",prevMonth),next.addEventListener("click",nextMonth),initCalendar(),todayBtn.addEventListener("click",(()=>{today=new Date,month=today.getMonth(),year=today.getFullYear(),initCalendar()})),dateInput.addEventListener("input",(e=>{dateInput.value=dateInput.value.replace(/[^0-9/]/g,""),2===dateInput.value.length&&(dateInput.value+="/"),dateInput.value.length>7&&(dateInput.value=dateInput.value.slice(0,7)),"deleteContentBackward"===e.inputType&&3===dateInput.value.length&&(dateInput.value=dateInput.value.slice(0,2))})),gotoBtn.addEventListener("click",gotoDate);